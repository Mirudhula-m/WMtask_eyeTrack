<!--
JATOS online experiment.
Working memory - Exogenous attention

Task date: 01082020 
-->

<!DOCTYPE html>

<html>

<head> <!--Contains metadata information about the document-->
	
	<meta charset = "UTF-8">
	<title>Exogenous Attention</title> <!--specifies title for the document-->
	
	<link href = "css/jspsych.css" rel="stylesheet" type="text/css"></link>

	<input type = "file" id = "file-input"/>
	
	<script src = "js/jspsych.js"></script>
	<script src = "snap_svg/snap.svg-min.js"></script>

	<!-- PLUGINS-->
	<script src = "js/plugins/static/jspsych-html-keyboard-response.js"></script>
	<script src = "js/plugins/static/jspsych-image-keyboard-response.js"></script>
	<script src = "js/plugins/static/jspsych-fullscreen.js"></script>
	<script src = "js/plugins/static/jspsych-resize.js"></script>
	<script src = "js/plugins/static/jspsych-single-stim.js"></script>
	<script src = "js/plugins/static/jspsych-call-function.js"></script>

	<!--EYE TRACKING-->
	<script src = "js/eyeTracking/gazerecorder.js"></script>
	<script src = "js/eyeTracking/eyeTrack.js"></script>
	<script src = "js/eyeTracking/eyeTrackScreens.js"></script>

	<!--EYE TRACKING - WEBGAZER-->
	<!--script src = "js/WebGazer/dist/webgazer.js" type="text/javascript"></script-->

	<!--HEAD TRACKING-->
	<!--script src = "js/headtrackr/headtrackr.js"></script-->

	<!--TASK DATA-->
	<script src = "js/getInputData.js"></script>
	<script src = "js/taskVariables.js"></script>

	<!--HELPER FUNCTIONS-->
	<script src = "js/helpers/generateRandNormal.js"></script>
	<script src = "js/helpers/circleParameters.js"></script>
	<script src = "js/helpers/fixationDot.js"></script>
	<script src = "js/helpers/calculateFinalAngles.js"></script>
	<script src = "js/helpers/generateBars.js"></script>
	<script src = "js/helpers/generateArcs.js"></script>
	<script src = "js/helpers/generateNoiseMask.js"></script>
	<script src = "js/helpers/presentationScreens.js"></script>
	<script src = "js/helpers/storingData.js"></script>
	<script src = "js/helpers/messages.js"></script>
	<script src = "js/helpers/trialRejection.js"></script>
	
	<!--TIMELINE GENERATION-->
	<script src = "js/training.js"></script>

	<script src = "/assets/javascripts/jatos.js"></script>

</head>

<body> <!--contains the visible page content-->

	<svg id = "svg"></svg>

</body>

<script>

	//document.body.style.cursor = 'none';

	//--------------------------------------------
	// setting background colour to gray.      
	//--------------------------------------------
	window.addEventListener("load",function() 
	{ 
		document.body.style.background = '#666666';
	});

	//--------------------------------------------
	// creating data storage variables
	//--------------------------------------------
	var timeline = [];

	var trialData;
	var all_trialData = [];
	var all_blockData = [];
	var response;

	var changeAngleData = [];
	
	//--------------------------------------------
	// JATOS code component
	//--------------------------------------------
//	jatos.onLoad(function(){
		timeline = timeline.concat(createTimeline());
		//--------------------------------------------
		// jsPsych code component
		//--------------------------------------------

		// start experiment
		jsPsych.init(
		{	
			timeline: timeline, 

/*			on_trial_finish: function(data)
			{
				if(data.is_trialData)
				{
					trialData = JSON.stringify({subjectNum: data.subjectNum, blockNum: data.blockNum, trialNum:data.trialNum, WM_cue: data.WM_cue, initialAngles: data.initialAngles, finalAngles: data.finalAngles, delayDurationFixation: data.delayDurationFixation, delayDuration: data.delayDuration, changeState: data.changeState, changeDirection: data.changeDirection, WM_Probe: data.WM_Probe, Response_AFC: data.Response_AFC, RT_AFC: data.RT_AFC, is_trialReject: data.is_trialReject}); 

					all_trialData.push(trialData);
					all_blockData.push(trialData);
					
					if(data.Response_AFC == -1)
						{ response = -1; }
					else if(data.changeState[data.WM_Probe-1] == data.Response_AFC)
						{ response = 1; }
					else if(data.changeState[data.WM_Probe-1] != data.Response_AFC)
						{ response = 0; }
					else
						{ response = 99; } // error

					jatos.appendResultData(data.WM_cue+" "+data.WM_Probe+" "+response+", ");
				
					if(data.trialNum == n_practiceTrials)
					{
						jatos.uploadResultFile(all_trialData, data.subjectNum+"_block"+data.blockNum+".txt");
						all_trialData = [];
						jatos.uploadResultFile(changeAngleData, subjectNum+"_staircaseData.txt");
					}
				}

				if(data.is_staircaseData)
				{
					changeAngleData_json =  JSON.stringify({changeAngle: data.oldChangeAngle, meanCorrect: data.meanCorrect});
					changeAngleData.push(changeAngleData_json);
				}

			},
			on_close: function(data) 
			{
	    		jatos.uploadResultFile(all_blockData, subjectNum+"_allTrials.txt");
	    		jatos.uploadResultFile(changeAngleData, subjectNum+"_staircaseData.txt");
	    		eyeTrackingData = JSON.stringify({gazeX: gazeX, gazeY: gazeY, headX: headX, headY: headY, headZ: headZ, headYaw: headYaw, headRoll: headRoll, headPitch: headPitch});
	    		jatos.uploadResultFile(eyeTrackingData, subjectNum+"_eyeTrackingData.txt");
	    		jatos.uploadResultFile(all_trial_latency, subjectNum+"_latencyData.txt");
	    		
			},
			on_finish: function(data)
			{
				jsPsych.data.displayData();
			}
*/		});

		window.onbeforeunload = (function(msg) 
		{
			var msg = "It is important to do this experiment all at once. "
					+ "Are you sure you want to close this window?";
			return msg;
		});
//	})

</script>

</html>